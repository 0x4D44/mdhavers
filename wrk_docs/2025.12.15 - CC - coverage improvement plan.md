# Code Coverage Improvement Plan
**Goal:** 98% Test Coverage for `mdhavers`

## Phase 1: Stabilization (Prerequisite)
**Objective:** Fix existing test failures to enable accurate full-system coverage measurement.

1.  **Fix `llvm_comprehensive_tests` Failures:**
    *   `closure_coverage`: Fix assertion mismatches.
    *   `destructuring_coverage`: Fix parse errors and assertion mismatches.
    *   `for_variations_coverage`: Fix loop iteration count mismatch.
    *   `fstring_coverage`: Fix parse error.
    *   `more_builtins_coverage2`: Fix flatten/zip output mismatches.
    *   `pipe_operator_coverage`: Fix "Undefined variable" compile errors.
    *   `while_edge_cases_coverage`: Fix parse error.
2.  **Verify Baseline:** Run `cargo llvm-cov` successfully and generate a unified report.

## Phase 2: Interpreter Coverage (Target: 90% -> 98%)
**Objective:** Close the 20% gap in `src/interpreter.rs`.

1.  **Identify Gaps:** Use `cargo llvm-cov show src/interpreter.rs` (or similar analysis) to find uncovered lines.
2.  **Targeted Tests:** Create a new test file `tests/interpreter_gap_coverage.rs` (or add to `src/interpreter.rs` tests) specifically for:
    *   Error paths in built-in functions.
    *   Edge cases in math operations (overflow, NaN).
    *   Complex object interactions (e.g., self-referential structures).
    *   Scots dialect aliases that aren't commonly used in standard tests.

## Phase 3: LLVM Backend Coverage (Target: 85% -> 98%)
**Objective:** Close the 25% gap in `src/llvm/codegen.rs`.

1.  **Identify Gaps:** Analyze coverage for `src/llvm/codegen.rs`.
2.  **Feature Expansion:** Add tests to `tests/llvm_comprehensive_tests.rs` covering:
    *   Rarely used opcodes/intrinsics.
    *   Complex type coercions during compilation.
    *   Runtime error generation (panic paths).
    *   Optimization edge cases (constant folding).

## Phase 4: Final Polish
**Objective:** Reach 98% total coverage.

1.  **Review Low-Coverage Modules:** Check `src/llvm/compiler.rs` and others.
2.  **Refactor Unreachable Code:** If code is genuinely unreachable/dead, remove it.
3.  **Final Verification:** Run full suite and generate final report.
