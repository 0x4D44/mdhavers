# validate_demo.braw - Demonstrate data validation in mdhavers
# "Make sure yer data's nae a load o' havers!"

fetch "lib/validate"

blether ""
blether "═══════════════════════════════════════════════════"
blether "    VALIDATION DEMO"
blether "    'Checkin' yer data's nae daft!'"
blether "═══════════════════════════════════════════════════"
blether ""

# ===============================================================
# String Validators
# ===============================================================

blether "=== String Validators ==="
blether ""

blether f"is_blank(''):       {is_blank('')}"
blether f"is_blank('   '):    {is_blank('   ')}"
blether f"is_blank('hello'):  {is_blank('hello')}"
blether f"is_present('hi'):   {is_present('hi')}"
blether ""

blether f"min_length('hello', 3):  {min_length('hello', 3)}"
blether f"min_length('hi', 3):     {min_length('hi', 3)}"
blether f"max_length('hello', 10): {max_length('hello', 10)}"
blether f"length_between('hello', 1, 10): {length_between('hello', 1, 10)}"
blether ""

blether f"is_alpha('Hello'):     {is_alpha('Hello')}"
blether f"is_alpha('Hello123'):  {is_alpha('Hello123')}"
blether f"is_numeric('12345'):   {is_numeric('12345')}"
blether f"is_numeric('123.45'):  {is_numeric('123.45')}"
blether f"is_alphanumeric('abc123'): {is_alphanumeric('abc123')}"
blether ""

# ===============================================================
# Email Validation
# ===============================================================

blether "=== Email Validation ==="
blether ""

ken emails = [
    "user@example.com",
    "test.user@domain.co.uk",
    "invalid",
    "@missing.com",
    "nodomain@",
    "no@dot",
    "valid@sub.domain.com"
]

blether "Testing email addresses:"
fer email in emails {
    ken valid = gin is_email(email) than "VALID" ither "INVALID"
    blether f"  {email}: {valid}"
}

blether ""

# ===============================================================
# URL Validation
# ===============================================================

blether "=== URL Validation ==="
blether ""

ken urls = [
    "https://example.com",
    "http://test.org",
    "ftp://notvalid.com",
    "example.com"
]

blether "Testing URLs:"
fer url in urls {
    ken valid = gin is_url(url) than "VALID" ither "INVALID"
    blether f"  {url}: {valid}"
}

blether ""

# ===============================================================
# Number Validators
# ===============================================================

blether "=== Number Validators ==="
blether ""

blether f"is_positive(5):   {is_positive(5)}"
blether f"is_positive(-5):  {is_positive(-5)}"
blether f"is_negative(-3):  {is_negative(-3)}"
blether f"is_zero(0):       {is_zero(0)}"
blether f"in_range(5, 1, 10): {in_range(5, 1, 10)}"
blether f"in_range(15, 1, 10): {in_range(15, 1, 10)}"
blether f"is_integer(5.0):  {is_integer(5.0)}"
blether f"is_integer(5.5):  {is_integer(5.5)}"
blether f"is_even(4):       {is_even(4)}"
blether f"is_odd(5):        {is_odd(5)}"

blether ""

# ===============================================================
# List Validators
# ===============================================================

blether "=== List Validators ==="
blether ""

ken numbers = [1, 2, 3, 4, 5]
ken empty_list = []

blether f"is_empty([1,2,3]): {is_empty(numbers)}"
blether f"is_empty([]):      {is_empty(empty_list)}"
blether f"is_nae_empty([1,2,3]): {is_nae_empty(numbers)}"
blether f"min_size([1,2,3,4,5], 3): {min_size(numbers, 3)}"
blether f"max_size([1,2,3,4,5], 10): {max_size(numbers, 10)}"
blether ""

blether "Using predicates on [1, 2, 3, 4, 5]:"
blether f"  all_pass (all positive): {all_pass(numbers, |n| n > 0)}"
blether f"  all_pass (all > 3):      {all_pass(numbers, |n| n > 3)}"
blether f"  any_pass (any > 3):      {any_pass(numbers, |n| n > 3)}"
blether f"  none_pass (none < 0):    {none_pass(numbers, |n| n < 0)}"

blether ""

# ===============================================================
# Schema Validation
# ===============================================================

blether "=== Schema Validation ==="
blether ""

ken user_schema = Schema()
user_schema.required("name")
user_schema.string("name")
user_schema.min_len("name", 2)
user_schema.max_len("name", 50)
user_schema.required("email")
user_schema.email("email")
user_schema.required("age")
user_schema.number("age")
user_schema.min_val("age", 18)
user_schema.max_val("age", 120)

blether "Schema rules defined fer: name, email, age"
blether ""

# Test valid data
ken valid_user = {
    "name": "Hamish MacGregor",
    "email": "hamish@scotland.scot",
    "age": 35
}

blether f"Testing valid user: {valid_user}"
ken is_valid = user_schema.validate(valid_user)
blether f"  Valid: {is_valid}"
blether f"  Errors: {user_schema.get_errors()}"
blether ""

# Test invalid data
ken invalid_user = {
    "name": "H",
    "email": "not-an-email",
    "age": 15
}

blether f"Testing invalid user: {invalid_user}"
ken is_valid2 = user_schema.validate(invalid_user)
blether f"  Valid: {is_valid2}"
blether "  Errors:"
fer error in user_schema.get_errors() {
    blether f"    - {error}"
}
blether ""

# Test missing fields
ken missing_fields_user = {
    "name": "Morag"
}

blether f"Testing user with missing fields: {missing_fields_user}"
ken is_valid3 = user_schema.validate(missing_fields_user)
blether f"  Valid: {is_valid3}"
blether "  Errors:"
fer error in user_schema.get_errors() {
    blether f"    - {error}"
}
blether ""

# ===============================================================
# Built-in Schemas
# ===============================================================

blether "=== Built-in Schemas ==="
blether ""

ken reg_schema = user_registration_schema()

ken good_registration = {
    "username": "angus_mccloud",
    "email": "angus@highland.scot",
    "age": 28
}

ken bad_registration = {
    "username": "ab",
    "email": "bad-email",
    "age": 10
}

blether "User Registration Schema:"
blether f"  Good data: {reg_schema.validate(good_registration)}"
blether f"  Bad data: {reg_schema.validate(bad_registration)}"
blether "  Bad data errors:"
fer error in reg_schema.get_errors() {
    blether f"    - {error}"
}

blether ""

# ===============================================================
# Product Schema
# ===============================================================

ken prod_schema = product_schema()

ken good_product = {
    "name": "Tartan Scarf",
    "price": 29.99
}

ken bad_product = {
    "name": "",
    "price": -5
}

blether "Product Schema:"
blether f"  Good product: {prod_schema.validate(good_product)}"
blether f"  Bad product: {prod_schema.validate(bad_product)}"
blether "  Bad product errors:"
fer error in prod_schema.get_errors() {
    blether f"    - {error}"
}

blether ""
blether "═══════════════════════════════════════════════════"
blether "    Validation demo complete!"
blether "    'Yer data's been weel checked!'"
blether "═══════════════════════════════════════════════════"
blether ""
